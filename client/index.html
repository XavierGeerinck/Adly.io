<html>
    <head>
        <script src="js/lib/react/react.js"></script>
        <script src="js/lib/react/JSXTransformer.js"></script>


        <script type="text/jsx">
            var dataChannel = doCreateDataChannels();

            // @todo: Move to it's own file
            var AdDisplay = React.createClass({
                handleOnClick: function() {
                    // We clicked the ad, send that we clicked it
                    dataChannel.send("Clicked on ad: " + this.props.name);

                    // Open the ad
                    window.open(this.props.url);
                },

                render: function() {
                    return (
                        <img src={this.props.image} name={this.props.name} onClick={this.handleOnClick} />
                    );
                }
            });

            var AdSystem = React.createClass({
                getInitialState: function() {
                    dataChannel.onmessage = this.onAdReceived;

                    return { image: "", url: "", name: "" };
                },

                onAdReceived: function(e) {
                    var data = JSON.parse(e.data);

                    this.setState({ image: data.image, name: data.name, url: data.url });
                },

                render: function() {
                    return (
                        <AdDisplay image={this.state.image} name={this.state.name } url={this.state.url} />
                    );
                }
            });

            React.renderComponent(<AdSystem/>, document.body);
        </script>

        <script src="js/lib/wrtc.js"></script>
        <script src="js/peer.js"></script>
    </head>
    <body>
        <div id="container"></div>

    </body>
</html>
